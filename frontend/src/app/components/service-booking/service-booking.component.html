<div class="booking-container">
  <div class="booking-header">
    <button class="btn-back-home" (click)="goBackToDashboard()">
      â† Torna alla Home
    </button>
    <h1>ğŸ’ˆ Prenota il Tuo Servizio</h1>
    <p class="subtitle">{{ selectedService?.nome || 'Seleziona servizio' }}</p>
  </div>

  <div class="progress-wizard">
    <div class="step" [class.active]="currentStep >= 1" [class.completed]="currentStep > 1">
      <div class="step-number">1</div>
      <div class="step-label">Servizio</div>
    </div>
    <div class="step-divider" [class.active]="currentStep > 1"></div>
    <div class="step" [class.active]="currentStep >= 2" [class.completed]="currentStep > 2">
      <div class="step-number">2</div>
      <div class="step-label">Barbiere</div>
    </div>
    <div class="step-divider" [class.active]="currentStep > 2"></div>
    <div class="step" [class.active]="currentStep >= 3" [class.completed]="currentStep > 3">
      <div class="step-number">3</div>
      <div class="step-label">Data</div>
    </div>
    <div class="step-divider" [class.active]="currentStep > 3"></div>
    <div class="step" [class.active]="currentStep >= 4">
      <div class="step-number">4</div>
      <div class="step-label">Orario</div>
    </div>
  </div>

  <div class="booking-step" *ngIf="currentStep === 1 && !selectedService">
    <h2>Scegli il Servizio</h2>
    <div class="services-grid">
      <div class="service-card" *ngFor="let service of services" (click)="selectService(service)">
        <div class="service-icon">âœ‚ï¸</div>
        <h3>{{ service.nome }}</h3>
        <p class="service-description">{{ service.descrizione }}</p>
        <div class="service-details">
          <span class="duration">â±ï¸ {{ service.durata }} min</span>
          <span class="price">â‚¬{{ service.prezzo }}</span>
        </div>
      </div>
    </div>
  </div>

  <div class="booking-step" *ngIf="currentStep === 2">
    <h2>Scegli il Barbiere</h2>
    <div class="barbers-grid">
      <div class="barber-card" *ngFor="let barber of barbers" (click)="selectBarber(barber)" [class.selected]="selectedBarber?.id === barber.id">
        <div class="barber-avatar">
          <span class="avatar-icon">ğŸ‘¨â€ğŸ’¼</span>
        </div>
        <div class="barber-info">
          <h3>{{ barber.nome }} {{ barber.cognome }}</h3>
          <p class="barber-experience">ğŸ“ {{ barber.esperienza }}</p>
          <p class="barber-specialty">âœ¨ {{ barber.specialita }}</p>
        </div>
        <button class="btn btn-primary">Seleziona</button>
      </div>
    </div>
  </div>

  <div class="booking-step" *ngIf="currentStep === 3">
    <h2>Scegli la Data</h2>
    <p class="date-hint">Seleziona una data in cui la barberia Ã¨ aperta</p>
    
    <div class="calendar-container">
      <div class="calendar-wrapper">
        <label for="date-input" class="calendar-label">ğŸ“… Seleziona una data</label>
        
        <div class="month-selector">
          <button class="btn-month-nav" (click)="previousMonth()">â†</button>
          <span class="current-month">{{ currentMonthDisplay }}</span>
          <button class="btn-month-nav" (click)="nextMonth()">â†’</button>
        </div>
        
        <div class="calendar-grid">
          <div class="calendar-weekday" *ngFor="let day of weekDays">{{ day }}</div>
          <div 
            class="calendar-day" 
            *ngFor="let day of calendarDays"
            [class.available]="day.available"
            [class.unavailable]="!day.available"
            [class.selected]="day.selected"
            [class.today]="day.isToday"
            [class.empty]="day.isEmpty"
            (click)="selectDate(day)"
          >
            <span *ngIf="!day.isEmpty">{{ day.number }}</span>
          </div>
        </div>
        
        <div class="calendar-legend">
          <div class="legend-item">
            <span class="legend-color available"></span>
            <span>Disponibile</span>
          </div>
          <div class="legend-item">
            <span class="legend-color unavailable"></span>
            <span>Chiuso/Non disponibile</span>
          </div>
          <div class="legend-item">
            <span class="legend-color selected"></span>
            <span>Selezionato</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="booking-step" *ngIf="currentStep === 4">
    <h2>Scegli l'Orario</h2>
    <p class="orario-subtitle">Seleziona uno slot disponibile</p>
    
    <div class="time-slots-container">
      <div class="time-slots-grid">
        <div class="time-slot" 
             *ngFor="let slot of availableSlots" 
             [class.available]="slot.available" 
             [class.unavailable]="!slot.available"
             [class.selected]="selectedTime?.time === slot.time"
             (click)="selectTime(slot)">
          <span class="slot-time">{{ formatTimeWithoutSeconds(slot.time) }}</span>
          <span class="slot-status" *ngIf="!slot.available">âŒ</span>
          <span class="slot-status" *ngIf="slot.available && selectedTime?.time === slot.time">âœ…</span>
        </div>
      </div>
    </div>
    
    <div *ngIf="availableSlots.length === 0" class="no-slots-message">
      <p>ğŸ˜” Nessuno slot disponibile per questa data</p>
      <button class="btn btn-secondary" (click)="previousStep()">
        â† Cambia Data
      </button>
    </div>
  </div>

  <div class="booking-summary" *ngIf="currentStep === 5 && selectedService && selectedBarber && selectedDate && selectedTime">
    <div class="summary-card">
      <h3>ğŸ“‹ Riepilogo Prenotazione</h3>
      <div class="summary-details">
        <div class="summary-row">
          <span class="summary-label">Servizio:</span>
          <span class="summary-value">{{ selectedService.nome }}</span>
        </div>
        <div class="summary-row">
          <span class="summary-label">Barbiere:</span>
          <span class="summary-value">{{ selectedBarber.nome }} {{ selectedBarber.cognome }}</span>
        </div>
        <div class="summary-row">
          <span class="summary-label">Data:</span>
          <span class="summary-value">{{ selectedDate | date:'dd/MM/yyyy' }}</span>
        </div>
        <div class="summary-row">
          <span class="summary-label">Orario:</span>
          <span class="summary-value">{{ formatTimeWithoutSeconds(selectedTime.time || '') }}</span>
        </div>
        <div class="summary-row">
          <span class="summary-label">Durata:</span>
          <span class="summary-value">{{ selectedService.durata }} minuti</span>
        </div>
        <div class="summary-row total">
          <span class="summary-label">Totale:</span>
          <span class="summary-value price">â‚¬{{ selectedService.prezzo }}</span>
        </div>
      </div>
      <button class="btn btn-primary btn-confirm" (click)="confirmBooking()">
        âœ… Conferma Prenotazione
      </button>
    </div>

    <div class="navigation-buttons">
      <button class="btn btn-secondary" (click)="previousStep()">
        â† Indietro
      </button>
    </div>
  </div>

  <div class="navigation-buttons" *ngIf="currentStep !== 5">
    <button class="btn btn-secondary" *ngIf="currentStep > 1" (click)="previousStep()">
      â† Indietro
    </button>
    <button class="btn btn-primary" *ngIf="currentStep < 4 && canProceed()" (click)="nextStep()">
      Avanti â†’
    </button>
  </div>
</div>