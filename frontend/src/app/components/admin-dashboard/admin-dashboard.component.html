<div class="admin-layout">
  
  <div class="sidebar">
    <div class="sidebar-header">
      <h3>üíà Admin Menu</h3>
    </div>
    <ul class="sidebar-nav">
      <li (click)="changeView('dashboard')" [class.active]="currentView === 'dashboard'">
        <span class="icon">üìÖ</span> Appuntamenti
      </li>
      <li (click)="changeView('servizi')" [class.active]="currentView === 'servizi'">
        <span class="icon">‚úÇÔ∏è</span> Gestione Servizi
      </li>
      <li (click)="changeView('barbieri')" [class.active]="currentView === 'barbieri'">
        <span class="icon">üë®‚Äçüíº</span> Gestione Barbieri
      </li>
      <li (click)="changeView('orari')" [class.active]="currentView === 'orari'">
        <span class="icon">‚è∞</span> Gestione Orari
      </li>
    </ul>
  </div>

  <div class="admin-content">
    
    <div [ngSwitch]="currentView">

      <div *ngSwitchCase="'dashboard'">
        <div class="dashboard-section">
          <div class="appointments-header">
            <h2>Appuntamenti del Giorno</h2>
            <input type="date" [value]="selectedDate" (change)="onDateChange($event)" class="date-picker" />
          </div>
          <div class="appointments-list">
            <div *ngIf="todaysAppointments.length === 0" class="empty-state">
              <span class="empty-icon">üìÖ</span>
              <h3>Nessun appuntamento</h3>
              <p>Nessun appuntamento trovato per il {{ selectedDate | date:'dd/MM/yyyy' }}.</p>
            </div>
            <div *ngFor="let app of todaysAppointments" class="appointment-card" [class]="'status-' + app.stato.toLowerCase()">
              <div class="app-time">{{ app.orarioInizio | slice:0:5 }}</div>
              <div class="app-details">
                <h4>{{ app.service.nome || 'Servizio' }}</h4>
                <p>
                  <strong>Barbiere:</strong> {{ app.barber.nome }} {{ app.barber.cognome }}<br>
                  <strong>Cliente ID:</strong> {{ app.id }}
                </p>
              </div>
              <div class="app-status">
                <span class="status-badge" [class]="'status-badge-' + app.stato.toLowerCase()">{{ app.stato }}</span>
                <div class="status-actions" *ngIf="app.stato === 'CONFERMATO'">
                  <button class="btn-status-start" (click)="setAppointmentStatus(app, 'IN_CORSO')">Inizia</button>
                </div>
                <div class="status-actions" *ngIf="app.stato === 'IN_CORSO'">
                  <button class="btn-status-complete" (click)="setAppointmentStatus(app, 'COMPLETATO')">Completa</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div *ngSwitchCase="'servizi'">
        <div class="dashboard-section">
          <h2>Gestione Servizi</h2>
          <div class="management-grid">
            <div class="form-container">
              <h3>{{ isEditingService ? 'Modifica Servizio' : 'Aggiungi Servizio' }}</h3>
              <form class="add-form" (ngSubmit)="saveService()">
                <div class="form-group"><label>Nome</label><input type="text" [(ngModel)]="serviceForm.nome" name="serviceNome" required /></div>
                <div class="form-row">
                  <div class="form-group"><label>Durata (min)</label><input type="number" [(ngModel)]="serviceForm.durata" name="serviceDurata" required /></div>
                  <div class="form-group"><label>Prezzo (‚Ç¨)</label><input type="number" [(ngModel)]="serviceForm.prezzo" name="servicePrezzo" required /></div>
                </div>
                <div class="form-group"><label>Descrizione</label><textarea rows="3" [(ngModel)]="serviceForm.descrizione" name="serviceDesc"></textarea></div>
                <button type="submit" class="btn-add">{{ isEditingService ? 'Salva Modifiche' : 'Aggiungi' }}</button>
                <button type="button" class="btn-cancel" *ngIf="isEditingService" (click)="resetServiceForm()">Annulla</button>
              </form>
            </div>
            <div class="list-container">
              <h3>Lista Servizi Esistenti</h3>
              <div *ngFor="let service of services" class="list-item">
                <span>{{ service.nome }} ({{ service.durata }} min)</span>
                <div class="item-actions">
                  <button class="btn-edit-small" (click)="editService(service)">Modifica</button>
                  <button class="btn-delete-small" (click)="deleteService(service.id)">X</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div *ngSwitchCase="'barbieri'">
        <div class="dashboard-section">
          <h2>Gestione Barbieri</h2>
          <div class="management-grid">
            <div class="form-container">
              <h3>{{ isEditingBarber ? 'Modifica Barbiere' : 'Aggiungi Barbiere' }}</h3>
              <form class="add-form" (ngSubmit)="saveBarber()">
                <div class="form-group"><label>Nome</label><input type="text" [(ngModel)]="barberForm.nome" name="barberNome" required /></div>
                <div class="form-group"><label>Cognome</label><input type="text" [(ngModel)]="barberForm.cognome" name="barberCognome" required /></div>
                <div class="form-group"><label>Esperienza</label><input type="text" [(ngModel)]="barberForm.esperienza" name="barberEsperienza" /></div>
                <div class="form-group"><label>Specialit√†</label><input type="text" [(ngModel)]="barberForm.specialita" name="barberSpecialita" /></div>
                <div class="form-group"><label><input type="checkbox" [(ngModel)]="barberForm.is_active" name="barberActive" /> Attivo</label></div>
                <button type="submit" class="btn-add">{{ isEditingBarber ? 'Salva Modifiche' : 'Aggiungi' }}</button>
                <button type="button" class="btn-cancel" *ngIf="isEditingBarber" (click)="resetBarberForm()">Annulla</button>
              </form>
            </div>
            <div class="list-container">
              <h3>Lista Barbieri Esistenti</h3>
              <div *ngFor="let barber of barbers" class="list-item">
                <span>{{ barber.nome }} {{ barber.cognome }}
                  <span [class]="barber.is_active ? 'status-active' : 'status-inactive'">
                    {{ barber.is_active ? '(Attivo)' : '(Non Attivo)' }}
                  </span>
                </span>
                <div class="item-actions">
                  <button class="btn-edit-small" (click)="editBarber(barber)">Modifica</button>
                  <button class="btn-delete-small" (click)="deleteBarber(barber.id)">X</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div *ngSwitchCase="'orari'">
        <div class="dashboard-section">
          <h2>‚è∞ Orari di Apertura Salone</h2>
          <div class="orari-container">
            <div *ngFor="let day of weekDays" class="shop-hours-item-large">
              <div class="day-info">
                <h3>{{ day.name }}</h3>
                <div class="hours-details" *ngIf="day.hours && !day.hours.isChiuso">
                  <span>üïê {{ day.hours.orarioApertura }} - {{ day.hours.orarioChiusura }}</span>
                </div>
                <div class="hours-details" *ngIf="day.hours && day.hours.isChiuso">
                  <span class="closed-badge">üö´ CHIUSO</span>
                </div>
                <div class="hours-details" *ngIf="!day.hours">
                  <span class="not-configured">‚ö†Ô∏è Non configurato</span>
                </div>
              </div>
              <button class="btn-edit" (click)="editShopHours(day.value)">Modifica</button>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>

  <div class="modal" *ngIf="showShopHoursModal">
    <div class="modal-content">
      <h3>Configura Orari per {{ getSelectedDayName() }}</h3>
      <form (ngSubmit)="saveShopHours()">
        <div class="form-group"><label><input type="checkbox" [(ngModel)]="shopHoursForm.isChiuso" name="isChiuso" /> Salone Chiuso</label></div>
        <div class="form-row" *ngIf="!shopHoursForm.isChiuso">
          <div class="form-group"><label>Orario Apertura</label><input type="time" [(ngModel)]="shopHoursForm.orarioApertura" name="orarioApertura" /></div>
          <div class="form-group"><label>Orario Chiusura</label><input type="time" [(ngModel)]="shopHoursForm.orarioChiusura" name="orarioChiusura" /></div>
        </div>
        <div class="form-actions">
          <button type="submit" class="btn-add">Salva</button>
          <button type="button" class="btn-cancel" (click)="closeShopHoursModal()">Annulla</button>
        </div>
      </form>
    </div>
  </div>
</div>